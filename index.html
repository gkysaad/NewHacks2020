<!DOCTYPE html>
<html>
<head>
	<title>Vroom! You've Got a Match</title>
	<link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>
	<header>
		<h1 class="title"> VROOM! YOU'VE GOT A MATCH! </h1>
	</header>
	<br><br><br>
	<div class="filter">
		<form class="filter" action ="script.js">
			<label for="year"> Year:</label>
			<input type="text" id="year" name="year"><br><br>
			Make: <select id="makes">
				<option>Any Make</option>
				<optgroup>
					<option value="Acura">Acura</option>
					<option value="Audi">Audi</option>
					<option value="BMW">BMW</option>
					<option value="Buick">Buick</option>
					<option value="Cadillac">Cadillac</option>
					<option value="Chevrolet">Chevrolet</option>
					<option value="Chrysler">Chrysler</option>
					<option value="Dodge">Dodge</option>
					<option value="Ram">Ram</option>
					<option value="Ferrari">Ferrari</option>
					<option value="Ford">Ford</option>
					<option value="GMC">GMC</option>
					<option value="Honda">Honda</option>
					<option value="Hyundai">Hyundai</option>
					<option value="Infiniti">Infiniti</option>
					<option value="Jaguar">Jaguar</option>
					<option value="Jeep">Jeep</option>
					<option value="Kia">Kia</option>
					<option value="Lamborghini">Lamborghini</option>
					<option value="Land Rover">Land Rover</option>
					<option value="Lexus">Lexus</option>
					<option value="Lincoln">Lincoln</option>
					<option value="Maserati">Maserati</option>
					<option value="Mazda">Mazda</option>
					<option value="Mercedes-AMG">Mercedes-AMG</option>
					<option value="Mercedes-Benz">Mercedes-Benz</option>
					<option value="MINI">MINI</option>
					<option value="Mitsubishi">Mitsubishi</option>
					<option value="Nissan">Nissan</option>
					<option value="Porsche">Porsche</option>
					<option value="Ram">Ram</option>
					<option value="Subaru">Subaru</option>
					<option value="Tesla">Tesla</option>
					<option value="Toyota">Toyota</option>
					<option value="Volkswagen">Volkswagen</option>
					<option value="Volvo">Volvo</option></optgroup>
			</select><br><br>
			<label for="mileage"> Mileage Limit:</label>
			<input type="text" id="mileage" name="mileage"><br><br>
			<label for="price"> Price Limit:</label>
			<input type="text" id="price" name="price"><br><br><br>
			<button type="button" onclick="getInputValue();">Find Car</button>

			<script>
			var year;
			var make;
			var mil;
			var prc;
		 	function getInputValue(){
            // Selecting the input element and get its value 
            year = document.getElementById("year").value;
            make = document.getElementById("makes").value;
            mil = document.getElementById("mileage").value;
            prc = document.getElementById("price").value;

			var data = new FormData();
			data.append("api_key", "tQY-a5ytQULq");
			data.append("start_url", "https://www.kijijiautos.ca/");
			data.append("send_email", "1");
			data.append("start_value_override", "{\"data\":[\n{\"make\": \"Toyota\", \n\"model\":\"RAV4\", \n\"year\":\"2015\",\n\"mileage\":\"10000\",\n\"price\":\"30000\"}]\n}");
			data.append("mode", "no-cors");

			var xhr = new XMLHttpRequest();
			xhr.withCredentials = true;

			xhr.addEventListener("readystatechange", function() {
			  if(this.readyState === 4) {
			    console.log(this.responseText);
			  }
			});

			xhr.open("POST", "https://www.parsehub.com/api/v2/projects/ttPuhXkthMpz/run");
			xhr.setRequestHeader("Content-Type", "multipart/form-data; boundary=--------------------------180401260797681213179167");

			xhr.send(data);
		}
            /*var myHeaders = new Headers();
			myHeaders.append("Content-Type", "multipart/form-data; boundary=--------------------------180401260797681213179167");

			var formdata = new FormData();
			formdata.append("api_key", "tQY-a5ytQULq");
			formdata.append("start_url", "https://www.kijijiautos.ca/");
			formdata.append("send_email", "1");
			formdata.append("start_value_override", "{\"data\":[\n{\"make\": \""+make+"\", \n\"model\":\"RAV4\", \n\"year\":\""+year+"\",\n\"mileage\":\""+mil+"\",\n\"price\":\""+prc+"\"}]\n}");

			var requestOptions = {
			  method: 'POST',
			  mode: 'no-cors',
			  headers: myHeaders,
			  body: formdata,
			  redirect: 'follow'
			};

			fetch("https://www.parsehub.com/api/v2/projects/ttPuhXkthMpz/run", requestOptions)
			  .then(response => response.text())
			  .then(result => console.log(result))
			  .catch(error => console.log('error', error));
			}
        	var request = fetch("https://www.parsehub.com/api/v2/projects/ttPuhXkthMpz/run", {
        		method: 'POST',
        		mode: 'no-cors',
        		headers: {
			    'Content-Type': 'application/form-data; charset=utf-8',
			    'api_key': 'tQY-a5ytQULq'
			  	},
			  	params: {'api_key': 'tQY-a5ytQULq'},
			  	body: JSON.stringify({
			  		'Content-Type': 'application/form-data',
			  	'api_key': 'tQY-a5ytQULq',
			    'start_url': 'https://www.kijijiautos.ca/',
			    'send_email': '1',
			    'start_value_override': '{"data":[\n{"make": "' + make + '", \n"model":"", \n"year":"' + year + '",\n"mileage":"' + mil + '",\n"price":"' + price + '"}]\n}'})})

			let result = request.json();
			console.log(result);
			request(options, function (error, response) { 
			  if (error) throw new Error(error);
			  console.log(response.body);
			  var result = JSON.stringify(response.body["run_token"]);
			  return result;
			});}

/*
			await new Promise(r => setTimeout(r, 30000));

			var request = require('request');

			request({
			  uri: 'https://www.parsehub.com/api/v2/projects/'+ret+'/last_ready_run/data',
			  method: 'GET',
			  gzip: true,
			  qs: {
			    api_key: "tQY-a5ytQULq",
			    format: "json"
			  }
			}, function(err, resp, body) {
			  console.log(body);
			}); */
			</script>

		</form>	
		<img src="background.jpg">
</body>
</html>